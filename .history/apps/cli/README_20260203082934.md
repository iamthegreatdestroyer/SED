# @sed/cli

Command-line interface for Semantic Entropy Differencing.

## Installation

```bash
# Global installation
npm install -g @sed/cli

# Or via npx
npx @sed/cli analyze
```

## Commands

### analyze

Analyze changes between two Git references using semantic entropy.

```bash
# Analyze changes between two commits
sed analyze v1.0.0 v2.0.0

# Analyze changes from a commit to HEAD
sed analyze v1.0.0

# Analyze with options
sed analyze v1.0.0 --format json --output report.json

# Analyze specific files
sed analyze v1.0.0 --include "src/**/*.ts"
```

Options:
- `-f, --format <format>` - Output format (text, json, html) [default: text]
- `-o, --output <file>` - Write output to file instead of stdout
- `--include <patterns...>` - Include patterns (glob)
- `--exclude <patterns...>` - Exclude patterns (glob)
- `--threshold <level>` - Minimum entropy level to report (trivial, low, medium, high, critical)
- `-v, --verbose` - Show verbose output
- `--no-color` - Disable colored output

### compare

Compare two files or directories for semantic similarity.

```bash
# Compare two files
sed compare file1.ts file2.ts

# Compare directories
sed compare src/old/ src/new/

# Compare with reference
sed compare --ref v1.0.0 src/
```

Options:
- `--ref <commit>` - Compare against a specific commit
- `-f, --format <format>` - Output format (text, json)
- `--semantic` - Show semantic similarity metrics

### report

Generate comprehensive analysis reports.

```bash
# Generate HTML report
sed report v1.0.0 v2.0.0 --format html -o report.html

# Generate JSON for CI integration
sed report v1.0.0 v2.0.0 --format json -o metrics.json

# Include changelog
sed report v1.0.0 v2.0.0 --changelog
```

Options:
- `-f, --format <format>` - Report format (html, json, markdown) [default: markdown]
- `-o, --output <file>` - Output file path
- `--changelog` - Include auto-generated changelog
- `--include-hunks` - Include detailed hunk-level analysis
- `--metrics` - Include only metrics (no visualizations)

### config

Manage SED configuration.

```bash
# Initialize configuration file
sed config init

# Show current configuration
sed config show

# Set a configuration value
sed config set threshold.critical 6.0
```

### info

Show repository and SED information.

```bash
# Show repo info
sed info

# Show version
sed info --version
```

## Configuration

Create a `.sedrc.json`, `sed.config.js`, or add a `"sed"` key to your `package.json`:

```json
{
  "threshold": {
    "trivial": 0.5,
    "low": 1.5,
    "medium": 3.0,
    "high": 5.0,
    "critical": 6.0
  },
  "include": ["src/**/*.ts", "lib/**/*.ts"],
  "exclude": ["**/*.test.ts", "**/*.spec.ts"],
  "languages": ["typescript", "javascript", "python"],
  "output": {
    "format": "text",
    "color": true
  }
}
```

### Environment Variables

- `SED_CONFIG` - Path to configuration file
- `SED_NO_COLOR` - Disable colored output
- `SED_DEBUG` - Enable debug logging

## Exit Codes

| Code | Meaning |
|------|---------|
| 0 | Success |
| 1 | General error |
| 2 | Configuration error |
| 3 | Git error |
| 4 | Analysis error |
| 5 | Invalid arguments |

## Examples

### CI/CD Integration

```yaml
# GitHub Actions example
- name: Analyze changes
  run: |
    npx @sed/cli analyze ${{ github.event.before }} ${{ github.sha }} \
      --format json \
      --output sed-report.json

- name: Upload report
  uses: actions/upload-artifact@v3
  with:
    name: sed-report
    path: sed-report.json
```

### Git Hooks

```bash
#!/bin/bash
# .git/hooks/pre-push

# Analyze changes being pushed
sed analyze origin/main HEAD --threshold critical

if [ $? -ne 0 ]; then
  echo "Critical entropy changes detected!"
  exit 1
fi
```

## License

MIT
