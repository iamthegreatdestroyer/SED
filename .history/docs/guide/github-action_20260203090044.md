# GitHub Action

Use SED in your GitHub CI/CD workflows for automated code analysis.

## Quick Start

Add SED to your workflow:

```yaml
name: SED Analysis
on: [pull_request]

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - uses: sgbilod/sed@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
```

## Inputs

| Input | Description | Default |
|-------|-------------|---------|
| `base` | Base commit for comparison | Auto-detected |
| `head` | Head commit for comparison | Auto-detected |
| `path` | Path to analyze | `.` |
| `include` | Include patterns (comma-separated) | `**/*` |
| `exclude` | Exclude patterns (comma-separated) | `node_modules/**` |
| `fail-on` | Fail on classification | `never` |
| `threshold` | Custom entropy threshold | - |
| `comment` | Post PR comment | `true` |
| `json-output` | Path for JSON report | - |
| `markdown-output` | Path for Markdown report | - |
| `summary` | Write job summary | `true` |

## Outputs

| Output | Description |
|--------|-------------|
| `total-entropy` | Total entropy across all files |
| `average-entropy` | Average entropy per file |
| `files-analyzed` | Number of files analyzed |
| `classification` | Overall classification |
| `json` | JSON analysis result |

## Usage Examples

### Basic PR Analysis

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
```

### Quality Gate

Fail the build if high-entropy changes are detected:

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    fail-on: high
```

### Custom Thresholds

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    threshold: '3.5'
    fail-on: high
```

### Filter Files

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    include: 'src/**/*.ts,lib/**/*.ts'
    exclude: '**/*.test.ts,**/__mocks__/**'
```

### Save Reports

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    json-output: 'sed-report.json'
    markdown-output: 'sed-report.md'

- uses: actions/upload-artifact@v3
  with:
    name: sed-reports
    path: |
      sed-report.json
      sed-report.md
```

### Use Output in Subsequent Steps

```yaml
- uses: sgbilod/sed@v1
  id: sed
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}

- name: Check Results
  run: |
    echo "Total Entropy: ${{ steps.sed.outputs.total-entropy }}"
    echo "Classification: ${{ steps.sed.outputs.classification }}"
    
    if [ "${{ steps.sed.outputs.classification }}" = "critical" ]; then
      echo "::warning::Critical changes detected!"
    fi
```

### Analyze Specific Commits

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    base: 'abc123'
    head: 'def456'
```

### Disable PR Comment

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    comment: false
```

## Complete Workflow Example

```yaml
name: SED Analysis

on:
  pull_request:
    types: [opened, synchronize]
  push:
    branches: [main]

jobs:
  analyze:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Run SED Analysis
        id: sed
        uses: sgbilod/sed@v1
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          include: 'src/**/*.ts,packages/*/src/**/*.ts'
          exclude: '**/*.test.ts,**/*.spec.ts'
          fail-on: critical
          json-output: 'sed-report.json'
      
      - name: Upload Report
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: sed-analysis
          path: sed-report.json
      
      - name: Check Threshold
        if: steps.sed.outputs.average-entropy > 3
        run: |
          echo "::warning::High average entropy detected: ${{ steps.sed.outputs.average-entropy }}"
```

## PR Comment

The action posts a comment on PRs with analysis results:

```markdown
## ðŸ“Š SED Analysis

**Classification:** ðŸŸ  HIGH

| Metric | Value |
|--------|-------|
| Files Analyzed | 5 |
| Total Entropy | 12.45 |
| Average Entropy | 2.49 |

<details>
<summary>File Details (5 files)</summary>

| File | Entropy | Classification |
|------|---------|----------------|
| src/index.ts | 3.21 | ðŸŸ  high |
| src/utils.ts | 2.15 | ðŸ’› medium |
| src/config.ts | 1.24 | ðŸ’š low |
| ... | ... | ... |

</details>
```

## Job Summary

When `summary: true`, the action writes a summary to the GitHub Actions job:

```markdown
## SED Analysis Summary

Analyzed 5 files between `abc123` and `def456`

| Classification | Count |
|----------------|-------|
| ðŸ”´ Critical | 0 |
| ðŸŸ  High | 1 |
| ðŸ’› Medium | 2 |
| ðŸ’š Low | 2 |
| âœ… Trivial | 0 |

**Total Entropy:** 12.45  
**Average Entropy:** 2.49
```

## Troubleshooting

### "Not in a git repository"

Ensure you checkout with full history:

```yaml
- uses: actions/checkout@v4
  with:
    fetch-depth: 0  # Required for commit comparison
```

### "Permission denied"

Add proper permissions:

```yaml
jobs:
  analyze:
    permissions:
      contents: read
      pull-requests: write
```

### Action Fails on Push Events

On push events without a PR, disable comments:

```yaml
- uses: sgbilod/sed@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    comment: ${{ github.event_name == 'pull_request' }}
```

## See Also

- [CLI Usage](/cli/)
- [Configuration](/guide/configuration)
- [Core Concepts](/guide/concepts)
