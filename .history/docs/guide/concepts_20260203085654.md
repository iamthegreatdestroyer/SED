# Core Concepts

Understanding the theory behind SED helps you interpret results and configure thresholds effectively.

## Information Theory Background

SED is based on **Shannon entropy**, a concept from information theory introduced by Claude Shannon in 1948.

### What is Entropy?

Entropy measures the **amount of information** or "surprise" in a message. In the context of code:

- **Low entropy** = predictable, expected changes
- **High entropy** = surprising, significant changes

### The Formula

For a discrete random variable $X$ with possible values $\{x_1, x_2, ..., x_n\}$ and probability mass function $P(X)$:

$$
H(X) = -\sum_{i=1}^{n} P(x_i) \log_2 P(x_i)
$$

In SED, we adapt this to measure code change complexity.

## AST-Based Analysis

SED doesn't just look at text differences - it parses code into **Abstract Syntax Trees (ASTs)** and analyzes structural changes.

### Why AST?

Traditional line-based diffs can be misleading:

```javascript
// This looks like a small change...
- const result = items.filter(x => x.active).map(x => x.value);
+ const result = items.filter(x => x.active).map(x => x.value).reduce((a, b) => a + b, 0);

// ...but it adds significant new behavior (reduce operation)
```

AST analysis reveals the true semantic change:
- Added: `reduce` call expression
- Impact: Aggregation behavior added

### AST Change Types

| Change Type | Description | Base Entropy |
|-------------|-------------|--------------|
| `added` | New node inserted | Higher |
| `deleted` | Node removed | Medium |
| `modified` | Node content changed | Variable |
| `renamed` | Identifier changed | Lower |
| `moved` | Node position changed | Lower |

## Entropy Calculation

SED calculates entropy for each AST change based on several factors:

### 1. Node Type Weight

Different AST node types have different baseline entropies:

```
Node Type              | Weight
───────────────────────────────
FunctionDeclaration    | 3.0
ClassDeclaration       | 4.0
MethodDefinition       | 2.5
VariableDeclaration    | 1.5
Expression             | 1.0
Literal                | 0.3
Comment                | 0.1
```

### 2. Change Type Multiplier

The type of change affects entropy:

```
Change Type | Multiplier
─────────────────────────
added       | 1.5
deleted     | 1.2
modified    | 1.0
renamed     | 0.5
moved       | 0.3
```

### 3. Context Factor

Changes in critical areas have higher weight:

- **Constructor/destructor** - 1.5x
- **Public API** - 1.3x
- **Error handling** - 1.4x
- **Security-sensitive** - 1.5x

### Final Entropy Formula

$$
E_{change} = W_{node} \times M_{change} \times F_{context} \times S_{scope}
$$

Where:
- $W_{node}$ = Node type weight
- $M_{change}$ = Change type multiplier
- $F_{context}$ = Context factor
- $S_{scope}$ = Scope depth factor

## Classification System

### Thresholds

The default classification thresholds:

| Classification | Min Entropy | Max Entropy | Meaning |
|----------------|-------------|-------------|---------|
| Trivial | 0.0 | 0.5 | Cosmetic changes |
| Low | 0.5 | 1.5 | Minor modifications |
| Medium | 1.5 | 3.0 | Moderate impact |
| High | 3.0 | 4.5 | Significant changes |
| Critical | 4.5 | ∞ | Major architectural |

### Aggregation

File-level entropy is the sum of all change entropies:

$$
E_{file} = \sum_{i=1}^{n} E_{change_i}
$$

Average entropy across files:

$$
E_{avg} = \frac{\sum_{j=1}^{m} E_{file_j}}{m}
$$

## Practical Examples

### Example 1: Adding a Comment

```diff
+ // This function handles user authentication
  function authenticate(user, password) {
```

**Analysis:**
- Node: Comment
- Weight: 0.1
- Change: added (1.5x)
- **Entropy: 0.15 (Trivial)**

### Example 2: Renaming a Variable

```diff
- const userData = fetchUser();
+ const userInfo = fetchUser();
```

**Analysis:**
- Node: VariableDeclaration
- Weight: 1.5
- Change: renamed (0.5x)
- **Entropy: 0.75 (Low)**

### Example 3: Adding a Method

```diff
class UserService {
+   async validateCredentials(email: string, password: string): Promise<boolean> {
+     const user = await this.findByEmail(email);
+     return user && await this.comparePassword(password, user.hash);
+   }
}
```

**Analysis:**
- Node: MethodDefinition
- Weight: 2.5
- Change: added (1.5x)
- Context: Public API (1.3x)
- **Entropy: 4.875 (Critical)**

### Example 4: Modifying Algorithm

```diff
function sortItems(items) {
-   return items.sort((a, b) => a - b);
+   return items.sort((a, b) => {
+     if (a.priority !== b.priority) {
+       return b.priority - a.priority;
+     }
+     return a.createdAt - b.createdAt;
+   });
}
```

**Analysis:**
- Multiple modified expressions
- Algorithm logic completely changed
- **Entropy: 3.8 (High)**

## Customization

You can customize entropy calculation:

### Custom Thresholds

```json
{
  "thresholds": {
    "trivial": 0.3,
    "low": 1.0,
    "medium": 2.5,
    "high": 4.0
  }
}
```

### Custom Node Weights

```json
{
  "nodeWeights": {
    "FunctionDeclaration": 4.0,
    "ClassDeclaration": 5.0,
    "TestCase": 0.5
  }
}
```

### Context Rules

```json
{
  "contextRules": [
    {
      "pattern": "**/security/**",
      "factor": 2.0
    },
    {
      "pattern": "**/*.test.ts",
      "factor": 0.5
    }
  ]
}
```

## Next Steps

- [Configuration](/guide/configuration) - Detailed configuration options
- [Custom Parsers](/guide/custom-parsers) - Add support for new languages
- [API Reference](/api/) - Programmatic usage
